# 実装計画

- [x] 1. プロジェクト基盤の構築
  - プロジェクト構造の作成とpackage.json設定（pnpm使用）
  - TypeScript設定（tsconfig.json）とtsgo設定
  - Vitest設定（vitest.config.ts）とテスト環境構築
  - manifest.jsonの作成（Manifest V3対応）
  - _要件: 3.1, 3.2, 3.3_

- [x] 2. 型定義と定数の実装（TDD）
- [x] 2.1 型定義の作成
  - TabInfoとGroupInfoインターフェースの定義
  - Chrome拡張機能API用の型定義の作成
  - Vitestテストセットアップファイルの作成
  - _要件: 1.1, 1.2, 2.1_

- [x] 2.2 定数定義の実装
  - AUTO_GROUP_PREFIX、IGNORED_URL_PATTERNS等の定数定義
  - グループ化設定値の定義とテスト
  - _要件: 1.1, 4.1_

- [x] 3. ドメインユーティリティの実装（TDD）
- [x] 3.1 extractDomain関数の実装
  - extractDomain関数のテストを先に作成（Red）
  - 最小限の実装でテストを通す（Green）
  - コードのリファクタリング（Refactor）
  - _要件: 1.1, 4.1_

- [x] 3.2 isValidDomain関数の実装
  - isValidDomain関数のテストを先に作成（Red）
  - 最小限の実装でテストを通す（Green）
  - コードのリファクタリング（Refactor）
  - _要件: 4.1_

- [x] 3.3 findTabsByDomain関数の実装
  - findTabsByDomain関数のテストを先に作成（Red）
  - Chrome APIモックを使用した実装（Green）
  - コードのリファクタリング（Refactor）
  - _要件: 1.1, 1.3_

- [x] 4. グループユーティリティの実装（TDD）
- [x] 4.1 isAutoGeneratedGroup関数の実装
  - isAutoGeneratedGroup関数のテストを先に作成（Red）
  - Chrome tabGroups APIモックを使用した実装（Green）
  - コードのリファクタリング（Refactor）
  - _要件: 2.1, 2.2_

- [x] 4.2 findGroupByDomain関数の実装
  - findGroupByDomain関数のテストを先に作成（Red）
  - Chrome tabGroups APIを使用した実装（Green）
  - コードのリファクタリング（Refactor）
  - _要件: 1.2, 2.1_

- [x] 4.3 createGroupForDomain関数の実装
  - createGroupForDomain関数のテストを先に作成（Red）
  - グループ作成ロジックの実装（Green）
  - コードのリファクタリング（Refactor）
  - _要件: 1.1_

- [x] 4.4 addTabToGroup関数の実装
  - addTabToGroup関数のテストを先に作成（Red）
  - タブグループ追加ロジックの実装（Green）
  - コードのリファクタリング（Refactor）
  - _要件: 1.2_

- [x] 5. タブ作成イベントハンドラーの実装（TDD）
- [x] 5.1 タブ作成時のグループ化ロジック
  - タブ作成イベント処理のテストを先に作成（Red）
  - onCreatedイベントハンドラーの実装（Green）
  - 処理フローの最適化（Refactor）
  - _要件: 1.1, 1.2, 1.3_

- [x] 6. タブ更新イベントハンドラーの実装（TDD）
- [x] 6.1 URL変更時のグループ移動ロジック
  - URL変更時の処理テストを先に作成（Red）
  - onUpdatedイベントハンドラーの実装（Green）
  - グループ移動ロジックの最適化（Refactor）
  - _要件: 1.1, 1.2, 2.1_

- [x] 7. タブ移動イベントハンドラーの実装（TDD）
- [x] 7.1 ウィンドウ間移動時のグループ化ロジック
  - ウィンドウ間移動処理のテストを先に作成（Red）
  - onMovedイベントハンドラーの実装（Green）
  - 移動先でのグループ化ロジックの最適化（Refactor）
  - _要件: 4.2_

- [x] 8. エラーハンドリングの実装（TDD）
- [x] 8.1 Chrome API呼び出しエラー処理
  - API呼び出しエラーのテストケースを作成（Red）
  - try-catch文を使用したエラーハンドリング実装（Green）
  - エラー処理の改善とログ機能追加（Refactor）
  - _要件: 4.3_

- [x] 8.2 状態整合性チェック機能
  - 無効なタブ/グループ参照のテストケースを作成（Red）
  - 状態チェック機能の実装（Green）
  - 整合性チェックロジックの最適化（Refactor）
  - _要件: 4.2, 4.3_

- [ ] 9. 統合テストとE2Eテスト
- [ ] 9.1 完全フローの統合テスト
  - タブ作成からグループ化までの統合テスト作成
  - URL変更時のグループ移動統合テスト作成
  - ウィンドウ間移動の統合テスト作成
  - _要件: 1.1, 1.2, 1.3, 2.1, 2.2_

- [ ] 9.2 エラーケースの統合テスト
  - 権限不足時の動作テスト
  - 無効なURL/ドメインでの動作テスト
  - Chrome API呼び出し失敗時の動作テスト
  - _要件: 4.1, 4.2, 4.3_

- [ ] 10. ビルドとパッケージング
- [ ] 10.1 本番用ビルド設定
  - tsgoを使用した本番ビルドプロセスの設定
  - dist/フォルダへの出力設定とmanifest.json調整
  - _要件: 3.1, 3.2_

- [ ] 10.2 Chrome拡張機能パッケージング
  - Chrome拡張機能として動作確認
  - 必要な権限の最終確認とmanifest.json調整
  - 拡張機能のテストとデバッグ
  - _要件: 3.3_